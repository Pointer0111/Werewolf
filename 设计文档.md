🐺 狼人杀在线游戏系统 — 需求分析文档（V1.0）
一、项目概述
1.1 项目背景

狼人杀是一款以逻辑推理与社交互动为核心的多人在线游戏。传统狼人杀以线下语音为主，存在组织困难、规则执行不统一、数据无法记录等问题。本项目旨在通过**Web 技术（Vue + FastAPI）**构建一个可在线进行的狼人杀游戏平台，实现玩家实时互动、身份分配、回合控制与自动裁判逻辑，提升游戏公平性与沉浸感。

1.2 项目目标

搭建一个可在浏览器端运行的狼人杀游戏平台；

实现用户注册、登录、匹配、建房、游戏进行、战绩记录等核心功能；

支持实时通信（WebSocket）；

实现房间管理与自动裁判逻辑；

为未来的 AI 主持人（AI Judge）扩展预留接口。

二、系统总体设计思路

系统采用前后端分离架构：

前端（Vue3 + Element Plus + Pinia/Vuex）：负责页面展示与交互；

后端（FastAPI）：负责业务逻辑、身份分配、游戏状态同步；

通信协议：

HTTP/REST：用户、房间管理；

WebSocket：游戏实时事件（发言、投票、夜晚行动）；

数据库：PostgreSQL / MySQL；

缓存：Redis（房间状态与游戏事件队列）；

鉴权：JWT；

部署方式：Docker 容器化部署。

三、功能需求分析
3.1 用户系统
功能	描述	备注
注册/登录	用户可通过邮箱或用户名注册、登录	使用 JWT 鉴权
用户信息	查看、修改昵称、头像、胜率等	
好友系统（可选）	添加好友、邀请进入房间	二期功能
战绩记录	查看历史游戏结果与表现	后端记录存档
3.2 房间与匹配系统
功能	描述	备注
创建房间	用户可自定义房间名、人数、角色配置	房主权限
加入房间	输入房间号或匹配系统自动分配	
房间聊天	在游戏前房间可进行文字聊天	WebSocket 通信
房主控制	开始游戏、踢人、解散房间	
匹配系统（可选）	自动分配房间或创建快速游戏	二期功能
3.3 游戏逻辑模块
（1）角色系统

支持的初始角色：

村民（Villager）

狼人（Werewolf）

预言家（Seer）

女巫（Witch）

猎人（Hunter）

守卫（Guard）

角色分配在游戏开始时由系统随机分配。

（2）游戏流程
阶段	说明	功能
夜晚	狼人行动、预言家查验、女巫救/毒、守卫守人	系统自动依次调用行动逻辑
白天	公告夜晚结果、玩家发言、投票公投	WebSocket 广播同步状态
投票	每人选择一个对象进行投票	自动统计、系统结算
胜负判定	系统自动检测胜利条件	村民方或狼人方获胜
3.4 实时通信系统
模块	功能描述
WebSocket 房间频道	房间内状态同步与广播
事件分发	不同游戏事件类型（发言、投票、行动）通过事件类型区分
消息格式	JSON 格式：{ type: "action", player_id: 1, data: {...} }
服务端事件管理	使用 FastAPI WebSocket + Redis Pub/Sub 实现多房间消息同步
3.5 裁判与逻辑处理

系统自动管理游戏状态机；

根据角色顺序与技能规则自动处理夜晚阶段；

每轮结束后自动判定是否满足胜负条件；

后期可接入 AI Judge 模块（自动语音/文字主持）。

3.6 数据与存储
数据类型	存储方式	示例
用户数据	数据库表 users	用户基本信息
房间信息	Redis 缓存 + DB 持久化	房间状态、成员、配置
游戏状态	Redis	当前轮数、存活玩家、行动结果
战绩数据	DB	游戏结果、玩家表现统计
四、非功能性需求
类别	需求
性能	支持 100+ 并发房间，单房间延迟 < 200ms
安全	JWT 鉴权、防作弊检测（如多开）
可扩展性	模块化架构，便于添加新角色或模式
可维护性	前后端接口文档自动生成（FastAPI Docs + Swagger）
兼容性	支持桌面浏览器与移动端自适应界面
日志监控	记录每场游戏事件与服务器日志，支持分析
五、系统模块划分

前端模块（Vue）

登录与注册界面

房间大厅与创建页面

游戏对局界面（昼夜切换动画、发言、投票）

用户个人信息与战绩页

后端模块（FastAPI）

用户与房间 REST API

游戏逻辑服务

WebSocket 实时通信服务

状态机管理模块（Game Engine）

数据存储与日志模块